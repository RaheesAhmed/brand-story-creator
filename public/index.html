<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Conscious Brand Sage</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <link rel="stylesheet" href="style.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <style>
        #loadingIndicator {
            display: none;
        }
        .hidden {
            display: none;
        }
    </style>
</head>
<body>
<div class="container my-5">
    <div class="text-center">
        <h1>Welcome to the Conscious Brand Sage</h1>
        <p>Turn your business ideas into reality with our comprehensive platform.</p>
    </div>

    <!-- Form to capture business details -->
    <form id="businessIdeaForm" class="mt-4">
      <!-- Business Name -->
      <div class="form-group">
        <label for="businessName">Business Name/Working Title:</label>
        <input
          type="text"
          class="form-control"
          id="businessName"
          name="businessName"
          placeholder="Do you have a name or a working title for your business?"
          required
        />
      </div>

      <!-- Nature of Business and Services -->
      <div class="form-group">
        <label for="natureOfBusiness">Nature of Business and Services:</label>
        <textarea
          class="form-control"
          id="natureOfBusiness"
          name="natureOfBusiness"
          rows="3"
          placeholder="What are the products or services you plan to offer?"
          required
        ></textarea>
      </div>

      <!-- Unique Selling Proposition -->
      <div class="form-group">
        <label for="uniqueSellingProposition"
          >Unique Selling Proposition:</label
        >
        <textarea
          class="form-control"
          id="uniqueSellingProposition"
          name="uniqueSellingProposition"
          rows="3"
          placeholder="What unique aspects make your business stand out?"
          required
        ></textarea>
      </div>

      <!-- Positive Impact -->
      <div class="form-group">
        <label for="positiveImpact">Positive Impact:</label>
        <textarea
          class="form-control"
          id="positiveImpact"
          name="positiveImpact"
          rows="3"
          placeholder="Clarify the positive impact or change you wish to create through your business."
          required
        ></textarea>
      </div>

      <!-- Target Audience -->
      <div class="form-group">
        <label for="targetAudience">Target Audience:</label>
        <textarea
          class="form-control"
          id="targetAudience"
          name="targetAudience"
          placeholder="Who are you most wanting to engage with?"
          required
        /></textarea>
      </div>

      <!-- Core Business Values -->
      <div class="form-group">
        <label for="coreValues">Core Business Values:</label>
        <textarea
          class="form-control"
          id="coreValues"
          name="coreValues"
          rows="3"
          required
          placeholder="What are the fundamental values that drive your business?"
        ></textarea>
      </div>

      <!-- Focus on Regeneration and Ethics -->
      <div class="form-group">
        <label for="regenerationFocus"
          >Focus on Regeneration and Ethics:</label
        >
        <textarea
          class="form-control"
          id="regenerationFocus"
          name="regenerationFocus"
          rows="3"
          placeholder="How does your business plan to incorporate sustainability and ethical practices?"
          required
        ></textarea>
      </div>

      <!-- Pricing Strategy -->
      <div class="form-group">
        <label for="pricingStrategy">Pricing Strategy:</label>
        <input
          type="text"
          class="form-control"
          id="pricingStrategy"
          name="pricingStrategy"
          placeholder="Are you considering a budget-friendly or premium approach?"
          required
        />
      </div>

      <button
        type="submit"
        id="submitBtn"
        class="btn btn-custom mt-4 text-center align-center py-2 bg-[#b3226aFF]"
        style="
          background-color: rgb(15, 15, 15);
          color: white;
          font-weight: 600;
        "
      >
        Generate Target Audience
      </button>
      <div id="loadingIndicator" class="text-center my-3" style="display: none;">
        <div class="spinner-border text-primary" role="status">
            <span class="sr-only">Loading...</span>
            
        </div>
        <p>Processing, please wait...</p>
    </div>
      
    </form>

    <!-- Target Audiences Display -->
    <div id="targetAudiencesSection" class="mt-4 hidden">
        <h4>Target Audiences</h4>
        <div id="targetAudiencesList"></div>
    </div>

    <!-- Brand Story Display -->
    <div id="brandStorySection" class="mt-4 hidden">
        <h4>Brand Story</h4>
        <p id="brandStory"></p>
    </div>

    <div id="loadingIndicator" class="spinner-border text-primary" role="status">
        <span class="sr-only">Loading...</span>
    </div>
</div>

<script>
$(document).ready(function() {
  
  $("#submitBtn").click(function (event) {
      event.preventDefault();
      var formData = {
        businessName: $("#businessName").val(),
        natureOfBusiness: $("#natureOfBusiness").val(),
        uniqueSellingProposition: $("#uniqueSellingProposition").val(),
        positiveImpact: $("#positiveImpact").val(),
        targetAudience: $("#targetAudience").val(),
        coreValues: $("#coreValues").val(),
        regenerationFocus: $("#regenerationFocus").val(),
        pricingStrategy: $("#pricingStrategy").val(),
    };
      showLoading(true);

      $.ajax({
          type: "POST",
          url: "http://localhost:3000/submit-business-form",
          contentType: "application/json",
          data: JSON.stringify(formData),
          success: function (response) {
              // Assuming 'response' is a plain string containing the target audiences
              console.log("Received Target Audiences: ", response);
              displayTargetAudiences(response.targetAudiences);
              showLoading(false);
          },
          error: function (error) {
              console.error("Error in form submission: ", error);
              $("#brandStory").html("<p>An error occurred while processing your request.</p>");
              showLoading(false);
          }
      });
     
      function displayTargetAudiences(responseString) {
    // Attempt to parse the response string to JSON
    try {
        // Assuming responseString is actually a stringified JSON that includes the targetAudiences stringified as well.
        let responseObject = JSON.parse(responseString); // First parse to get the object
        let targetAudiencesString = responseObject.targetAudiences; // Access the stringified target audiences
        
        // Now, targetAudiencesString should be another stringified JSON, parse it to get the array
        let targetAudiences = JSON.parse(targetAudiencesString);
        
        // Clear previous audiences
        $("#targetAudiencesList").empty();
        
        // Iterate over each audience in the array
        targetAudiences.forEach(audience => {
            var audienceHtml = `
                <div class="card mt-2">
                    <div class="card-body">
                        <h5 class="card-title">${audience.name}</h5>
                        <p class="card-text">${audience.description}</p>
                        <button class="btn btn-secondary select-audience" data-audience='${JSON.stringify(audience)}'>Select Audience</button>
                    </div>
                </div>`;
            // Append the constructed HTML to the DOM
            $("#targetAudiencesList").append(audienceHtml);
        });

        // Make the target audiences section visible
        $("#targetAudiencesSection").removeClass("hidden");
    } catch (error) {
        console.error("Error parsing target audiences:", error);
        // Handle the error (e.g., show an error message)
    }
}

  


$(document).on('click', '.select-audience', function() {
    var audience = JSON.parse($(this).attr("data-audience"));
    generateBrandStory(audience);
});




  function generateBrandStory(selectedAudience) {
      $("#loadingIndicator").show();
      $.ajax({
          type: "POST",
          url: "/generate-story-for-audience", // Update this URL based on your routing
          contentType: "application/json",
          data: JSON.stringify({"targetAudience": selectedAudience}),
          success: function(response) {
              $("#brandStory").text(response.brandStory);
              $("#brandStorySection").removeClass("hidden");
          },
          error: function() {
              alert("An error occurred while generating the brand story. Please try again.");
          },
          complete: function() {
              $("#loadingIndicator").hide();
          }
      });
  }
});

function showLoading(isLoading) {
    if (isLoading) {
        $("#loadingIndicator").show();
    } else {
        $("#loadingIndicator").hide();
    }
}

});
</script>
</body>
</html>
